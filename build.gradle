plugins {
    id 'java'
}

group 'com.aukocharlie'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    implementation group: 'junit', name: 'junit', version: '4.13.2'
    implementation group: 'org.projectlombok', name: 'lombok', version: '1.18.22'
    annotationProcessor group: 'org.projectlombok', name: 'lombok', version: '1.18.22'
}


jar {
    manifest {
        attributes("Implementation-Title": "Gradle",
                "Implementation-Version": version)
    }
}

compileTestJava {
    // Show parameter names
//    options.compilerArgs << "-parameters"
    // Export necessary package
    options.compilerArgs = [
            '--add-exports', 'jdk.compiler/com.sun.tools.javac.api=ALL-UNNAMED',
            '--add-exports', 'jdk.compiler/com.sun.tools.javac.util=ALL-UNNAMED',
            '--add-exports', 'jdk.compiler/com.sun.tools.javac.file=ALL-UNNAMED',
            '--add-exports', 'jdk.compiler/com.sun.tools.javac.tree=ALL-UNNAMED',
            '--add-exports', 'jdk.jdi/com.sun.tools.jdi=ALL-UNNAMED'
    ]
}

compileJava {
    doFirst {
        // Export necessary package
        options.compilerArgs = [
                '--add-exports', 'jdk.compiler/com.sun.tools.javac.api=recorder4j.main',
                '--add-exports', 'jdk.compiler/com.sun.tools.javac.util=recorder4j.main',
                '--add-exports', 'jdk.compiler/com.sun.tools.javac.file=recorder4j.main',
                '--add-exports', 'jdk.compiler/com.sun.tools.javac.tree=recorder4j.main',
                '--add-exports', 'jdk.jdi/com.sun.tools.jdi=recorder4j.main'
        ]
    }
}
java {
    // Solve: module 'lombok' not found.
    modularity.inferModulePath.set(true)
}

sourceCompatibility = 11